<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BandhanByPreeti - Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>
    <script src="firebaseConfig.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-pink-50 to-red-50">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-xl font-bold text-pink-600">BandhanByPreeti</h1>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <button id="supportButton" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
                            Support
                        </button>
                        <button id="logoutButton" class="ml-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-pink-600 hover:bg-pink-700">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main content -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Search Filters -->
            <div class="bg-white shadow rounded-lg p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="md:hidden">
                        <label class="block text-sm font-medium text-gray-700">Search</label>
                        <input type="text" id="mobileSearch" placeholder="Search profiles..." 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">City</label>
                        <input type="text" id="cityFilter" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Min Age</label>
                        <input type="number" id="minAge" min="18" max="99" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Max Age</label>
                        <input type="number" id="maxAge" min="18" max="99" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Religion</label>
                        <select id="religionFilter" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                            <option value="">Any</option>
                            <option>Hindu</option>
                            <option>Muslim</option>
                            <option>Christian</option>
                            <option>Sikh</option>
                            <option>Buddhist</option>
                            <option>Jain</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Education</label>
                        <select id="educationFilter" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                            <option value="">Any</option>
                            <option>Graduate</option>
                            <option>Post Graduate</option>
                            <option>PhD</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Occupation</label>
                        <select id="occupationFilter" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                            <option value="">Any</option>
                            <option>Engineer</option>
                            <option>Doctor</option>
                            <option>Teacher</option>
                            <option>Business</option>
                        </select>
                    </div>
                    <div class="flex items-center">
                        <button id="applyFilters" class="w-full bg-pink-600 text-white py-2 px-4 rounded-md hover:bg-pink-700">
                            Apply Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profiles Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Profile cards will be populated here -->
            </div>
        </main>
    </div>

    <script>
        // Mobile menu functionality
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
        const closeMobileMenu = document.getElementById('closeMobileMenu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.remove('translate-x-full');
            mobileMenu.classList.add('translate-x-0');
            mobileMenuOverlay.classList.remove('hidden');
        });

        closeMobileMenu.addEventListener('click', () => {
            mobileMenu.classList.remove('translate-x-0');
            mobileMenu.classList.add('translate-x-full');
            mobileMenuOverlay.classList.add('hidden');
        });

        mobileMenuOverlay.addEventListener('click', () => {
            mobileMenu.classList.remove('translate-x-0');
            mobileMenu.classList.add('translate-x-full');
            mobileMenuOverlay.classList.add('hidden');
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const mobileSearch = document.getElementById('mobileSearch');

        searchInput.addEventListener('input', searchProfiles);
        mobileSearch.addEventListener('input', searchProfiles);

        function searchProfiles() {
            const searchTerm = this.value.toLowerCase();
            // Add your search logic here
        }

        // Filter functionality
        document.getElementById('applyFilters').addEventListener('click', applyFilters);

        function applyFilters() {
            const filters = {
                city: document.getElementById('cityFilter').value,
                minAge: document.getElementById('minAge').value,
                maxAge: document.getElementById('maxAge').value,
                religion: document.getElementById('religionFilter').value,
                education: document.getElementById('educationFilter').value,
                occupation: document.getElementById('occupationFilter').value
            };
            // Add your filter logic here
        }

        // Profile matching algorithm
        function getMatchingProfiles() {
            const currentUser = firebase.auth().currentUser;
            if (!currentUser) return;

            // Get current user's gender
            firebase.database().ref('profiles/' + currentUser.uid).once('value')
                .then(snapshot => {
                    const userGender = snapshot.val().gender;
                    
                    // Query profiles of opposite gender
                    const query = firebase.database().ref('profiles')
                        .orderByChild('gender')
                        .equalTo(userGender === 'male' ? 'female' : 'male');
                    
                    query.once('value').then(snapshot => {
                        // Display matching profiles
                        displayProfiles(snapshot.val());
                    });
                });
        }

        function displayProfiles(profiles) {
            const profilesGrid = document.querySelector('.grid');
            profilesGrid.innerHTML = '';

            Object.values(profiles).forEach(profile => {
                const profileCard = createProfileCard(profile);
                profilesGrid.appendChild(profileCard);
            });
        }

        function createProfileCard(profile) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-lg overflow-hidden';
            
            card.innerHTML = `
                <div class="aspect-w-16 aspect-h-9">
                    <img src="${profile.photoURL || 'default-avatar.jpg'}" alt="Profile Photo" class="w-full h-full object-cover">
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-semibold">${profile.fullName}</h3>
                    <p class="text-gray-600">${profile.age} years old • ${profile.city}, ${profile.country}</p>
                    <div class="mt-4 flex justify-between">
                        <button class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600">
                            View Profile
                        </button>
                        <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
                            Send Message
                        </button>
                    </div>
                </div>
            `;

            return card;
        }

        // Initialize
        getMatchingProfiles();
    </script>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">City</label>
                        <input type="text" id="cityFilter" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Min Age</label>
                        <input type="number" id="minAge" min="18" max="99" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Max Age</label>
                        <input type="number" id="maxAge" min="18" max="99" 
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Religion</label>
                        <select id="religionFilter" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-pink-500 focus:ring-pink-500">
                            <option value="">All</option>
                            <option value="hindu">Hindu</option>
                            <option value="muslim">Muslim</option>
                            <option value="christian">Christian</option>
                            <option value="sikh">Sikh</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Profiles Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="profilesGrid">
                <!-- Profiles will be loaded here -->
            </div>
        </main>
    </div>

    <script>
        // Check if user is logged in
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // Get user's profile
            const profileRef = db.ref(`profiles/${user.uid}`);
            const snapshot = await profileRef.once('value');
            if (!snapshot.exists()) {
                window.location.href = 'create-profile.html';
                return;
            }

            // Load profiles
            loadProfiles();
        });

        // Load profiles based on filters
        async function loadProfiles() {
            const user = auth.currentUser;
            const userRef = db.ref(`profiles/${user.uid}`);
            const userSnapshot = await userRef.once('value');
            const userData = userSnapshot.val();

            // Get opposite gender profiles
            const profilesRef = db.ref('profiles');
            profilesRef.orderByChild('gender').equalTo(userData.gender === 'male' ? 'female' : 'male')
                       .on('value', (snapshot) => {
                const profiles = snapshot.val();
                displayProfiles(profiles);
            });
        }

        // Display profiles in grid
        function displayProfiles(profiles) {
            const container = document.getElementById('profilesGrid');
            container.innerHTML = '';

            for (const [uid, profile] of Object.entries(profiles)) {
                if (profile.status === 'suspended') continue;
                
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow overflow-hidden';
                card.innerHTML = `
                    <div class="aspect-w-16 aspect-h-9 bg-gray-200">
                        ${profile.photoURL ? 
                            `<img src="${profile.photoURL}" alt="${profile.name}" class="object-cover w-full h-full">` : 
                            '<div class="flex items-center justify-center h-full text-gray-400">No Photo</div>'
                        }
                    </div>
                    <div class="p-4">
                        <h3 class="text-lg font-medium text-gray-900">${profile.name}</h3>
                        <p class="text-sm text-gray-500">${profile.age} years old</p>
                        <p class="text-sm text-gray-500">${profile.city}, ${profile.country}</p>
                        <p class="text-sm text-gray-500">${profile.religion}</p>
                        <button onclick="startChat('${uid}')" 
                                class="mt-4 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
                            Message
                        </button>
                    </div>
                `;
                container.appendChild(card);
            }
        }

        // Start chat with profile
        function startChat(uid) {
            const user = auth.currentUser;
            const chatId = [user.uid, uid].sort().join('_');
            window.location.href = `chat.html?chatId=${chatId}`;
        }

        // Support button click
        document.getElementById('supportButton').addEventListener('click', () => {
            window.location.href = 'support-chat.html';
        });

        // Logout
        document.getElementById('logoutButton').addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            });
        });
    </script>
</body>
</html>
